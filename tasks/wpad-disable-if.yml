---

- name: get state of interface "{{ interface }}"
  ansible.builtin.command: "networksetup -getproxyautodiscovery \"{{ interface }}\""
  register: ifstate
  changed_when: false
  ignore_errors: true

- name: turn off wpad
  ansible.builtin.command: "networksetup -setproxyautodiscovery \"{{ interface }}\" off"
  become: yes
  when: ifstate.stdout.find("Off") == -1
